# EX-AI MCP Server - Main Project Environment Configuration Template
# Copy this file to .env and fill in your API keys
# Keep .env out of version control

# ============================================================================
# CORE CONFIGURATION
# ============================================================================
DEFAULT_MODEL=glm-4.5-flash
ROUTER_ENABLED=true
GLM_ENABLE_WEB_BROWSING=true

# ============================================================================
# EXPERT ANALYSIS CONFIGURATION
# ============================================================================
DEFAULT_USE_ASSISTANT_MODEL=true
EXPERT_HEARTBEAT_INTERVAL_SECS=5

# ============================================================================
# WEBSOCKET DAEMON CONFIGURATION
# ============================================================================
EXAI_WS_HOST=127.0.0.1
EXAI_WS_PORT=8079
LOG_LEVEL=INFO

# ============================================================================
# KIMI API CONFIGURATION (Moonshot)
# ============================================================================
KIMI_API_KEY=
KIMI_BASE_URL=https://api.moonshot.ai/v1
KIMI_API_URL=https://api.moonshot.ai/v1

# ============================================================================
# GLM API CONFIGURATION (ZhipuAI)
# ============================================================================
# Using z.ai proxy (3x faster than open.bigmodel.cn according to user testing)
# Alternative: https://open.bigmodel.cn/api/paas/v4 (official but slower)
GLM_API_KEY=
GLM_BASE_URL=https://api.z.ai/api/paas/v4
GLM_API_URL=https://api.z.ai/api/paas/v4

# Legacy vars for backward compatibility (same as GLM_* above)
ZHIPUAI_API_KEY=
ZHIPUAI_API_URL=https://api.z.ai/api/paas/v4
ZHIPUAI_BASE_URL=https://api.z.ai/api/paas/v4

# ============================================================================
# TIMEOUT CONFIGURATION (Coordinated Hierarchy)
# ============================================================================
# These timeouts follow a coordinated hierarchy to ensure proper timeout behavior:
# HTTP Client → Tool Level → Daemon Level → Shim Level → Client Level
# Rule: Each outer timeout = 1.5x inner timeout (50% buffer)
#
# CRITICAL: HTTP Client timeout is the foundation - must be >= workflow tool timeout
# This was the root cause of the "SDK hanging" issue (was 60s, needed 300s)
EX_HTTP_TIMEOUT_SECONDS=300

# Tool-level timeouts
SIMPLE_TOOL_TIMEOUT_SECS=60
WORKFLOW_TOOL_TIMEOUT_SECS=300
EXPERT_ANALYSIS_TIMEOUT_SECS=180

# Provider-specific timeouts
GLM_TIMEOUT_SECS=90
KIMI_TIMEOUT_SECS=120
KIMI_WEB_SEARCH_TIMEOUT_SECS=150

# Infrastructure timeouts (auto-calculated by TimeoutConfig if not set)
# Daemon timeout: 450s (1.5x workflow tool timeout)
# Shim timeout: 600s (2x workflow tool timeout)
# Client timeout: 750s (2.5x workflow tool timeout)

# ============================================================================
# CIRCUIT BREAKER CONFIGURATION
# ============================================================================
CIRCUIT_BREAKER_FAILURE_THRESHOLD=5
CIRCUIT_BREAKER_RECOVERY_TIMEOUT_SECS=300

# ============================================================================
# SESSION MANAGEMENT CONFIGURATION
# ============================================================================
SESSION_TIMEOUT_SECS=3600
SESSION_MAX_CONCURRENT=100
SESSION_CLEANUP_INTERVAL=300

# ============================================================================
# FILE PATH HANDLING
# ============================================================================
# Allow relative file paths in tool requests (auto-resolved to absolute paths)
# EX_ALLOW_RELATIVE_PATHS=true

# ============================================================================
# KIMI (MOONSHOT) PROVIDER SETTINGS
# ============================================================================
AGENTIC_ENABLE_LOGGING=true
KIMI_MAX_HEADER_LEN=4096
KIMI_FILES_MAX_SIZE_MB=20
KIMI_DEFAULT_MODEL=kimi-k2-0905-preview
KIMI_THINKING_MODEL=kimi-thinking-preview
KIMI_SPEED_MODEL=kimi-k2-turbo-preview
KIMI_CACHE_TOKEN_TTL_SECS=1800
KIMI_CACHE_TOKEN_LRU_MAX=256

# ============================================================================
# TEST FILES DIRECTORY
# ============================================================================
# Absolute path(s) to folder(s) containing sample files for upload/extract tests
# Supports multiple roots separated by comma or semicolon
TEST_FILES_DIR=

# ============================================================================
# STREAMING CONFIGURATION
# ============================================================================
GLM_STREAM_ENABLED=false
KIMI_STREAM_ENABLED=false
KIMI_STREAM_TIMEOUT_SECS=240
KIMI_STREAM_PRIME_CACHE=false

